{% extends 'base.html' %}
{% load entry_filters %}

{% block title %}{{ entry.title }} - Diary Entry{% endblock %}

{% block page_title %}{{ entry.title }}{% endblock %}

{% block content %}
    <div style="margin-bottom: 20px;">
        <a href="{% url 'entry_list' %}" style="color: #007bff; text-decoration: none;">&larr; Back to All Entries</a>
    </div>

    <article style="background-color: #f8f9fa; padding: 20px; border-radius: 5px;">
        <header style="border-bottom: 1px solid var(--theme-border); padding-bottom: 15px; margin-bottom: 20px; color: var(--theme-text);">
            <h1 style="color: var(--theme-text);">{{ entry.title }}</h1>
            <p style="color: var(--theme-text-light); margin: 0;">
                ğŸ“… <strong>{{ entry.date|date:"l, F j, Y" }}</strong>
                {% if entry.created_at.date != entry.date %}
                    <br><em style="color: #6c757d; font-size: 0.9em;">âœï¸ Actually written on {{ entry.created_at|date:"l, F j, Y" }} at {{ entry.created_at|time:"g:i A" }}</em>
                {% else %}
                    <br><em style="color: #6c757d; font-size: 0.9em;">âœï¸ Written at {{ entry.created_at|time:"g:i A" }}</em>
                {% endif %}
                {% if entry.updated_at != entry.created_at %}
                    <br><em style="color: #6c757d; font-size: 0.85em;">ğŸ“ Last updated: {{ entry.updated_at|date:"l, M j, Y" }} at {{ entry.updated_at|time:"g:i A" }}</em>
                {% endif %}
                {% if entry.is_private %}
                    <span style="background-color: #ffc107; color: #856404; padding: 2px 6px; border-radius: 3px; font-size: 0.8em; margin-left: 10px;">ğŸ”’ Private</span>
                {% endif %}
            </p>
        </header>


        {% if entry.image %}
            <div style="margin-bottom: 20px; text-align: center;">
                <a href="#" onclick="showImageModal('{{ entry.image.url }}'); return false;">
                    <img src="{{ entry.image.url }}" alt="{{ entry.title }}" style="width: 120px; height: 120px; object-fit: cover; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); cursor:pointer;">
                </a>
                <p class="has-text-grey">Click thumbnail to enlarge</p>
            </div>
        {% endif %}
    <!-- Image Modal -->
    <div id="image-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.7); z-index:1000; align-items:center; justify-content:center;">
        <span onclick="closeImageModal()" style="position:absolute; top:30px; right:40px; color:#fff; font-size:2.5em; cursor:pointer; z-index:1001;">&times;</span>
        <img id="modal-img" src="" alt="Full size" style="max-width:90vw; max-height:80vh; border-radius:10px; box-shadow:0 4px 32px rgba(0,0,0,0.3); display:block; margin:auto;">
    </div>

    <script>
    function showImageModal(url) {
        var modal = document.getElementById('image-modal');
        var img = document.getElementById('modal-img');
        img.src = url;
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }
    function closeImageModal() {
        var modal = document.getElementById('image-modal');
        modal.style.display = 'none';
        document.getElementById('modal-img').src = '';
        document.body.style.overflow = '';
    }
    // Close modal on background click
    document.addEventListener('DOMContentLoaded', function() {
        var modal = document.getElementById('image-modal');
        modal.addEventListener('click', function(e) {
            if (e.target === modal) closeImageModal();
        });
    });
    </script>

        <div style="line-height: 1.8;">{{ entry.content|urlize_target_blank }}</div>
        {% if can_export %}
        <form method="post" style="margin-top: 2em;">
            {% csrf_token %}
            <button type="submit" name="export_type" value="pdf" class="button is-link">Export to PDF</button>
            <button type="submit" name="export_type" value="text" class="button is-primary">Export to Text</button>
        </form>
        {% endif %}
    </article>

    <div style="margin-top: 30px; text-align: center;">
        <a href="{% url 'entry_update' entry.pk %}" class="btn" style="background-color: #28a745; margin-right: 10px;">Edit Entry</a>
        <a href="{% url 'toggle_archive_entry' entry.pk %}" class="btn" style="background-color: #6c757d; margin-right: 10px;">
            {% if entry.is_archived %}ğŸ“¤ Restore{% else %}ğŸ“¦ Archive{% endif %}
        </a>
        <a href="{% url 'entry_delete' entry.pk %}" class="btn" style="background-color: #dc3545;">Delete Entry</a>
    </div>
{% endblock %}
