{% extends 'base.html' %}

{% block title %}Archive Dashboard - Diary App{% endblock %}

{% block page_title %}📦 Archive Dashboard{% endblock %}

{% block content %}
    <div style="margin-bottom: 20px;">
        <a href="{% url 'entry_list' %}" style="color: #007bff; text-decoration: none;">&larr; Back to Entries</a>
    </div>

    <!-- Statistics Section -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
        <div style="background-color: #e3f2fd; padding: 20px; border-radius: 5px; text-align: center;">
            <h3 style="margin: 0; color: #1976d2;">{{ total_entries }}</h3>
            <p style="margin: 5px 0 0 0; color: #666;">Total Entries</p>
        </div>
        <div style="background-color: #f3e5f5; padding: 20px; border-radius: 5px; text-align: center;">
            <h3 style="margin: 0; color: #7b1fa2;">{{ archived_entries }}</h3>
            <p style="margin: 5px 0 0 0; color: #666;">Archived</p>
        </div>
        <div style="background-color: #e8f5e8; padding: 20px; border-radius: 5px; text-align: center;">
            <h3 style="margin: 0; color: #388e3c;">{{ active_entries }}</h3>
            <p style="margin: 5px 0 0 0; color: #666;">Active</p>
        </div>
        <div style="background-color: #fff3e0; padding: 20px; border-radius: 5px; text-align: center;">
            <h3 style="margin: 0; color: #f57c00;">{{ can_auto_archive }}</h3>
            <p style="margin: 5px 0 0 0; color: #666;">Eligible for Archive</p>
        </div>
    </div>

    <!-- Quick Actions -->
    <div style="background-color: #f8f9fa; padding: 20px; border-radius: 5px; margin-bottom: 30px;">
        <h3 style="margin-top: 0;">Quick Actions</h3>
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            {% if can_auto_archive > 0 %}
                <a href="{% url 'bulk_archive' %}" 
                   style="background-color: #ffc107; color: #212529; padding: 10px 15px; text-decoration: none; border-radius: 5px; display: flex; align-items: center; gap: 5px;">
                    📦 Archive Old Entries ({{ can_auto_archive }})
                </a>
            {% endif %}
            <a href="{% url 'entry_search' %}?include_archived=on" 
               style="background-color: #17a2b8; color: white; padding: 10px 15px; text-decoration: none; border-radius: 5px; display: flex; align-items: center; gap: 5px;">
                🔍 View Archived Entries
            </a>
            <a href="{% url 'entry_search' %}" 
               style="background-color: #28a745; color: white; padding: 10px 15px; text-decoration: none; border-radius: 5px; display: flex; align-items: center; gap: 5px;">
                🔍 Search All Entries
            </a>
        </div>
    </div>

    <!-- Archive by Year -->
    {% if yearly_stats %}
        <div style="margin-bottom: 30px;">
            <h3>📅 Archive by Year</h3>
            <div style="display: grid; gap: 15px;">
                {% for year_data in yearly_stats %}
                    <div style="border: 1px solid #ddd; padding: 15px; border-radius: 5px; background-color: white;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h4 style="margin: 0;">{{ year_data.year }}</h4>
                            <span style="color: #666;">{{ year_data.total }} entries</span>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; font-size: 0.9em;">
                            <div>Active: <strong>{{ year_data.active }}</strong></div>
                            <div>Archived: <strong>{{ year_data.archived }}</strong></div>
                            {% if year_data.eligible %}
                                <div style="color: #ffc107;">Eligible: <strong>{{ year_data.eligible }}</strong></div>
                            {% endif %}
                        </div>
                        {% if year_data.eligible > 0 %}
                            <div style="margin-top: 10px;">
                                <a href="{% url 'bulk_archive' %}?year={{ year_data.year }}" 
                                   style="background-color: #ffc107; color: #212529; padding: 5px 10px; text-decoration: none; border-radius: 3px; font-size: 0.9em;">
                                    📦 Archive {{ year_data.year }} Entries
                                </a>
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}

    <!-- Recently Archived -->
    {% if recently_archived %}
        <div style="margin-bottom: 30px;">
            <h3>📦 Recently Archived</h3>
            <div style="display: grid; gap: 10px;">
                {% for entry in recently_archived %}
                    <div style="border: 1px solid #ddd; padding: 10px; border-radius: 5px; background-color: #f8f9fa; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>{{ entry.title }}</strong>
                            <span style="color: #666; margin-left: 10px;">
                                {{ entry.date|date:"M j, Y" }}
                            </span>
                            {% if entry.tags %}
                                <div style="margin-top: 5px;">
                                    {% for tag in entry.get_tag_list %}
                                        <span style="background-color: #e9ecef; color: #495057; padding: 2px 6px; border-radius: 3px; font-size: 0.8em; margin-right: 5px;">
                                            #{{ tag }}
                                        </span>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <span style="color: #666; font-size: 0.9em;">
                                Archived {{ entry.archived_at|timesince }} ago
                            </span>
                            <a href="{% url 'toggle_archive_entry' entry.pk %}" 
                               style="background-color: #28a745; color: white; padding: 5px 10px; text-decoration: none; border-radius: 3px; font-size: 0.9em;">
                                📤 Restore
                            </a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}

    <!-- Archive Management Tips -->
    <div style="background-color: #e7f3ff; padding: 20px; border-radius: 5px; border-left: 4px solid #007bff;">
        <h4 style="margin-top: 0; color: #007bff;">💡 Archive Management Tips</h4>
        <ul style="margin-bottom: 0;">
            <li><strong>Auto-Archive:</strong> Entries older than 6 months are eligible for archiving to keep your main diary view focused.</li>
            <li><strong>Search Archives:</strong> Use the search feature with "Include archived entries" to find old memories.</li>
            <li><strong>Restore Anytime:</strong> Archived entries can be restored to active status whenever needed.</li>
            <li><strong>Performance:</strong> Archiving helps maintain fast loading times as your diary grows over time.</li>
        </ul>
    </div>
{% endblock %}
