{% extends 'base.html' %}
{% block title %}Manage Subscription - Diary App{% endblock %}

{% block content %}
<div class="subscription-dashboard">
    <h2>Manage Your Subscription</h2>
    <div class="subscription-status">
        <strong>Status:</strong>
        <span class="status-{{ subscription.status }}">{{ subscription.get_status_display }}</span>
        {% if subscription.status == 'active' %}
            <span class="badge badge-success">Active</span>
        {% elif subscription.status == 'expired' %}
            <span class="badge badge-danger">Expired</span>
        {% elif subscription.status == 'pending' %}
            <span class="badge badge-warning">Pending Payment</span>
        {% endif %}
    </div>
    <div class="subscription-details">
        <p><strong>Plan:</strong> {{ subscription.plan.name }} ({{ subscription.plan.get_plan_type_display }})</p>
        <p><strong>Start Date:</strong> {{ subscription.start_date|date:'M d, Y' }}</p>
        <p><strong>End Date:</strong> {{ subscription.end_date|date:'M d, Y' }}</p>
        <p><strong>Auto Renew:</strong> {{ subscription.auto_renew|yesno:"Yes,No" }}</p>
        <p><strong>Days Left:</strong> {{ subscription.days_until_expiry }}</p>
    </div>
    <div class="subscription-actions">
        {% if subscription.status == 'active' and subscription.auto_renew %}
            <form method="post" action="{% url 'subscriptions:cancel' %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-warning">Cancel Auto-Renewal</button>
            </form>
        {% endif %}
        <a href="{% url 'subscriptions:plans' %}" class="btn btn-primary">Change Plan</a>
    </div>
    <hr>
    <h3>Usage</h3>
    <ul>
        <li><strong>Entries Created:</strong> {{ usage.entries_created }}</li>
        <li><strong>Reminders Created:</strong> {{ usage.reminders_created }}</li>
    </ul>
    <hr>
    <h3>Payment History</h3>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Date</th>
                <th>Amount</th>
                <th>Status</th>
                <th>Method</th>
            </tr>
        </thead>
        <tbody>
            {% for payment in payments %}
            <tr>
                <td>{{ payment.payment_date|date:'M d, Y' }}</td>
                <td>${{ payment.amount }}</td>
                <td>{{ payment.get_status_display }}</td>
                <td>{{ payment.get_payment_method_display }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="4">No payment history found.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
